Done:
- Add microphysics variation in env
- we want only ONCE gamma max & min injection
  -> tracer "hasBeenShocked" that stops particle injection for the next N time steps
- add normalisations values for radiation
- checked N cells constant in each shell
- checked carefully Minu's emission paper, corrected typos
  -> normalization values now good
- implemented Band function spectras
  PROBLEM: RS goes over 1 -> because I used Minu normalization with G&G model? 
  QUESTION: time to use for plotting compared to sim? (for now I set tilde{T} to 1 to see the spectras)

Ongoing task:
- Band function emission from simulation (ultra thin emitting shell)

Todo (detailed):
- rewrite eqn (4) in draft properly (with divergence, independant of coordinate system)
- paper figures Hydro:
  Fig 5 and Fig 9 of Minu
  values in shocked region (taken near the CD) in cart vs sph
  snapshots in spherical
  shock strength with time
- explicit what I do in a document (article draft?)
- plots with time from a single cell viewpoint:
  -> how many timesteps does it take for a cell to go from first shock passage to having cooled below gamma_min = 1.
- basic model: Genet & Granot 2009 section 3.1 (Band functions, use spherical symmetry)
  -> /!\ definition of \tilde{T} /!\
  -> start with that, then replace with distrib
  -> check Beniamini & Granot 2016, section 4.2, with beta' = 0 (gamma' = 1)
- next step: spectrum from "real" electron distribution
  -> cf picture, left fast cooling, right normal cooling
- Colle et al 2012 method for SRHD -> emission
- Minu emission paper eqn G18-19-20 for the parameter space, play with parameters keeping those X_0 constants
/!\ we also have observational constraints (u1 : 100-1000, L and t_off quite constraint)
for example: higher u1 to have less fast cooling (cause eB depends on R0)
we want to see the different regimes (very fast, fast, marginally fast..), a few representative sims

Calculating radiations:
1. construct "timestep" electron distribution taking into account coolign from previous timestep
(see whiteboard picture)
-> when gmax1 < gmin0 -> "instantaneous" e distrib is delta function
-> add broken power-law from integrating over timestep
2. local emissivity. Take care of electron number, time elapsed. Which scheme do we use?
Later: check check & recheck. For emission, try out on basic situations (shock tubes, BM..) to make sure everything is in place

Tasks:
FOCUS pdV
- calculate cooling timescales to verify transition between rad cooling and adiab
- in Ayache paper -> eq 19 is y_min - 1, also in equation 17 it's gamma'_e^2-1
- begin draft with hydro results
    reproduce Minu's plots to compare cart with analytics
    spherical to cartesian comparisons
    compare relfdiff of variables for diff a_u
- take cells compression into account for analytical estimates to compare snapshots to?
- how do we create lightcurves/spectras
- note: in very strong cooling case, we will have to do some analytical estimates for the 

Electron distribution & radiation work
- better rules for e- distribution inside GAMMA (gmin, gmax)
- postprocessing

python code
- microphysics params are in phys_constants, add to environment
- organize Tools folder (one plotting script, and sources in a subfolder, organize them more)
- object programming for variables to plot? (allow for easier implementation of new ones)

later stuff
Add shock strength = Mach number of shock in upstream
Add switch for zoneID if check detection was used or not?

FOCUS:
1. launch sims internal shocks
--> do we reproduce the analytics in planar symmetry?
start at the beginning of the shock
don't even need split/merge (at least for starters)
box size -> moving window (see BM method, but use density and not only pressure bcause cold shells)
u1 = 100, u4 = 200, density contrast ~1/4 (slowest is more dense)...
see Minu's notes for quantities to plot
/!\ add velocity before and after shells to avoid shock structures on the external sides as much as possible
for this compare with expected ram pressure of the CD in the lab frame
in spherical define starting radius
maybe test for highest Lorentz
start with few hundreds cells and then test for convergence
check if algo detectes very small rarefaction wave on the front/back of the shells
-> move the box depending on that
--> and now in spherical symmetry
2. electron distribution in the flow
-> shock detection
-> cooling regimes
3. lightcurves production
-> be careful of relativistic effects (highly relativistic shells)
-> good test case: BM profile

Todolist:
1. Cell resolution, numerics, and plotting
- find a way to fuse cells in the shocked nebula but not too much
- once we're only limited by cells at shocks, asks about adaptive timestep
- recheck N&H cons2prim and RC EoS
- add theoretical estimates (expected Rcd growth rate with time)
- choice of x, y normalization on plot function

2. Shocks and self-similarity
- debug .apply() method
-> will be useful in lots of cases: especially analyzing sims ran without it -> update zone id
- change shock strength to Mach number (of shock front in unshocked medium)
- if shocks not resolved, we may have 2 identified shock cells close to each other
-> important to take in account for the e- distribution
-> choose where to renew e- population where compression ratio is met?
-> rego over NS06, check the values for q (page 4 before section 5.) and related shock strength
--> maybe let's go over the more general case, compare with BM76
--> Gamma43 as function of "q" (downstream to shock ratio)

3. Emitted radiation
- write post-processing of sim
-> first using the gamma_min and gamma_max from GAMMA
-> from shock detection in our method
First only one power-law, then add before and after gamma_min & gamma_max + cooling regimes

4. Jets in GAMMA
- make a setup file -> kinda done but hard to check in 2D
- discussion with Frederic Daigne
- papiers Ayache Daigne, Lamberts Daigne pour comparer les approches
- question du reverse shock dans l'afterglow (diversité des lightcurves difficile à expliquer avec FS seulement)
-> parler de notre taf avec Minu
- variabilité de l'injection -> variabilité du profil de densité qui peut influencer le passage du RS
- faut vraiment les lightcurves ptn
- Uhm, Zhang 2012 -> checker le Uhm Beloborodov 2007 pour la méthode

5. Internal shocks: collision of two (cold) shells 
-> ask Minu
-> relative Lorentz factor, densities ratio, shell width, collision radius...
equal width in the lab frame is a good starting assumption
-> redo current test case in planar and spherical
